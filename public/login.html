<!-- --- START OF FILE login.html --- -->

<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HỆ THỐNG ĐĂNG NHẬP V1.0.26</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700;900&display=swap" rel="stylesheet">

    <style>
        :root { --neon-green: #00ff41; --dark-green: #003b0f; --bg-black: #000000; --card-bg: #050505; }
        * { margin: 0; padding: 0; box-sizing: border-box; user-select: none; }
        body { background: var(--bg-black); font-family: 'Roboto', sans-serif; height: 100vh; overflow: hidden; display: flex; justify-content: center; align-items: center; color: var(--neon-green); }
        #matrixCanvas { position: fixed; top: 0; left: 0; z-index: 0; opacity: 0.8; }
        .login-card-wrapper { position: relative; z-index: 10; width: 100%; max-width: 520px; padding: 4px; border-radius: 8px; overflow: hidden; box-shadow: 0 0 50px rgba(0, 255, 65, 0.15); }
        .login-card-wrapper::before, .login-card-wrapper::after { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: conic-gradient(transparent, transparent, transparent, var(--neon-green)); animation: rotateBorder 4s linear infinite; }
        .login-card-wrapper::after { animation-delay: -2s; }
        @keyframes rotateBorder { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .login-card-inner { position: relative; background: var(--card-bg); padding: 50px 40px; border-radius: 6px; z-index: 20; display: flex; flex-direction: column; gap: 20px; }
        .card-header { text-align: center; margin-bottom: 20px; }
        .sys-logo { font-family: 'Roboto', sans-serif; font-size: 3rem; font-weight: 900; color: #fff; text-shadow: 0 0 15px var(--neon-green); letter-spacing: 1px; line-height: 1; text-transform: uppercase; }
        .sys-sub { font-family: 'Roboto', sans-serif; font-size: 0.85rem; color: var(--neon-green); letter-spacing: 3px; font-weight: 700; text-transform: uppercase; margin-top: 10px; opacity: 0.9; }
        .input-group { position: relative; margin-bottom: 15px; }
        .input-label { font-family: 'Roboto', sans-serif; font-weight: 500; font-size: 0.8rem; margin-bottom: 8px; display: block; color: #888; letter-spacing: 1px; transition: 0.3s; text-transform: uppercase; }
        .cyber-input { width: 100%; padding: 16px; background: #0f0f0f; border: 1px solid #333; color: #fff; font-family: 'Roboto', sans-serif; font-size: 1rem; transition: all 0.3s ease; outline: none; border-radius: 4px; }
        .cyber-input:focus { border-color: var(--neon-green); box-shadow: 0 0 15px rgba(0, 255, 65, 0.3); background: #000; }
        .cyber-input:focus + .input-label { color: var(--neon-green); }
        .btn-cyber { width: 100%; padding: 18px; background: var(--neon-green); color: #000; border: none; font-family: 'Roboto', sans-serif; font-weight: 900; font-size: 1.2rem; letter-spacing: 1px; text-transform: uppercase; cursor: pointer; margin-top: 20px; transition: 0.3s; border-radius: 4px; position: relative; overflow: hidden; box-shadow: 0 0 20px rgba(0, 255, 65, 0.5); }
        .btn-cyber:hover { background: #fff; box-shadow: 0 0 40px var(--neon-green); transform: scale(1.02); }
        .switch-link { text-align: center; margin-top: 20px; font-size: 0.9rem; color: #666; cursor: pointer; font-family: 'Roboto', sans-serif; transition: 0.3s; }
        .switch-link:hover { color: var(--neon-green); text-decoration: underline; }
        .sys-footer { position: fixed; bottom: 15px; width: 100%; text-align: center; font-size: 0.75rem; color: #555; z-index: 10; font-family: 'Roboto', sans-serif; letter-spacing: 1px; }
        #toast-container { position: fixed; top: 20px; right: 20px; z-index: 99999; }
        .toast { background: #111; color: #fff; border-left: 4px solid; padding: 15px 25px; margin-bottom: 10px; min-width: 300px; box-shadow: 0 5px 20px rgba(0,0,0,0.8); font-family: 'Roboto', sans-serif; display: flex; align-items: center; border: 1px solid #333; animation: slideIn 0.4s; }
        .toast.success { border-left-color: var(--neon-green); color: var(--neon-green); }
        .toast.error { border-left-color: #ff003c; color: #ff003c; }
        @keyframes slideIn { from { transform: translateX(100%); opacity:0; } to { transform: translateX(0); opacity:1; } }
    </style>
</head>
<body>

    <canvas id="matrixCanvas"></canvas>
    <div id="toast-container"></div>

    <div class="login-card-wrapper">
        <div class="login-card-inner">
            
            <div class="card-header">
                <div class="sys-logo" id="mainTitle">SYSTEM V1.0.26</div>
                <div class="sys-sub">CỔNG KẾT NỐI BẢO MẬT</div>
            </div>

            <div class="form-section">
                <!-- 1. TÊN TÀI KHOẢN -->
                <div class="input-group">
                    <label class="input-label">TÊN TÀI KHOẢN</label>
                    <input type="text" id="user" class="cyber-input" placeholder="Nhập tài khoản..." maxlength="20" autocomplete="off">
                </div>
                
                <!-- 2. MẬT KHẨU -->
                <div class="input-group">
                    <label class="input-label">MẬT KHẨU</label>
                    <input type="password" id="pass" class="cyber-input" placeholder="Nhập mật khẩu..." maxlength="20">
                </div>

                <!-- 3. XÁC NHẬN MẬT KHẨU (Hiện khi đăng ký) -->
                <div class="input-group" id="confirmBox" style="display:none;">
                    <label class="input-label">XÁC NHẬN MẬT KHẨU</label>
                    <input type="password" id="confirmPass" class="cyber-input" placeholder="Nhập lại mật khẩu..." maxlength="20">
                </div>

                <!-- 4. SỐ ĐIỆN THOẠI (ĐÃ CHUYỂN XUỐNG DƯỚI CÙNG) -->
                <div class="input-group" id="phoneBox" style="display:none;">
                    <label class="input-label">SỐ ĐIỆN THOẠI (ZALO)</label>
                    <input type="text" id="phoneInput" class="cyber-input" placeholder="Nhập SĐT của bạn..." maxlength="15">
                </div>

                <!-- NÚT HÀNH ĐỘNG -->
                <button onclick="handleAuth()" id="btnAction" class="btn-cyber">
                    KẾT NỐI NGAY
                </button>

                <div class="switch-link" onclick="toggleMode()" id="switchText">
                    Chưa có tài khoản? Đăng ký thành viên mới
                </div>
            </div>
        </div>
    </div>

    <div class="sys-footer">
        HỆ THỐNG ĐƯỢC MÃ HÓA END-TO-END | PHIÊN BẢN 5.0.2 STABLE
    </div>

    <script>
        // MATRIX EFFECT
        const canvas = document.getElementById('matrixCanvas');
        const ctx = canvas.getContext('2d');
        function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
        window.addEventListener('resize', resize); resize();
        const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"; 
        const fs = 15; const cols = canvas.width / fs; const drops = Array(Math.floor(cols)).fill(1);
        function draw() {
            ctx.fillStyle = "rgba(0, 0, 0, 0.05)"; ctx.fillRect(0, 0, canvas.width, canvas.height);
            ctx.fillStyle = "#00ff41"; ctx.font = "bold " + fs + "px monospace";
            for(let i=0; i<drops.length; i++){
                const t = chars[Math.floor(Math.random()*chars.length)];
                ctx.fillText(t, i*fs, drops[i]*fs);
                if(drops[i]*fs > canvas.height && Math.random()>0.975) drops[i]=0;
                drops[i]++;
            }
        }
        setInterval(draw, 35);

        let isLogin = true;

        function showToast(msg, type = 'success') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            const icon = type === 'success' ? '✔' : '✖';
            toast.innerHTML = `<span style="margin-right:15px; font-size:1.2rem;">${icon}</span> <span>${msg}</span>`;
            container.appendChild(toast);
            setTimeout(() => { toast.style.opacity = '0'; setTimeout(() => toast.remove(), 500); }, 3000);
        }

        function toggleMode() {
            isLogin = !isLogin;
            const title = document.getElementById('mainTitle');
            const btn = document.getElementById('btnAction');
            const switchText = document.getElementById('switchText');
            const confirmBox = document.getElementById('confirmBox');
            const phoneBox = document.getElementById('phoneBox'); 

            if (isLogin) {
                title.innerText = "SYSTEM V1.0.26";
                btn.innerText = "KẾT NỐI NGAY";
                switchText.innerText = "Chưa có tài khoản? Đăng ký thành viên mới";
                confirmBox.style.display = "none";
                phoneBox.style.display = "none"; // Ẩn khi đăng nhập
            } else {
                title.innerText = "KHỞI TẠO ID";
                btn.innerText = "ĐĂNG KÝ";
                switchText.innerText = "Đã có tài khoản? Đăng nhập ngay";
                confirmBox.style.display = "block";
                phoneBox.style.display = "block"; // Hiện khi đăng ký
            }
        }

        async function handleAuth() {
            const username = document.getElementById('user').value.trim();
            const password = document.getElementById('pass').value.trim();
            const confirmPass = document.getElementById('confirmPass').value.trim();
            const phone = document.getElementById('phoneInput').value.trim();

            const endpoint = isLogin ? '/api/login' : '/api/register';

            if (!username || !password) return showToast("Vui lòng nhập đầy đủ thông tin!", "error");

            if (!isLogin) {
                if (password !== confirmPass) return showToast("Mật khẩu xác nhận không khớp!", "error");
                if (!phone) return showToast("Vui lòng nhập Số điện thoại!", "error");
            }

            const btn = document.getElementById('btnAction');
            const originalText = btn.innerText;
            btn.innerText = "ĐANG XỬ LÝ...";
            btn.style.opacity = "0.7";
            btn.disabled = true;

            try {
                const res = await fetch(endpoint, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password, phone })
                });
                const data = await res.json();

                if (data.status === 'success') {
                    if (isLogin) {
                        localStorage.setItem('token', data.token);
                        localStorage.setItem('role', data.role);
                        localStorage.setItem('username', data.username);
                        localStorage.setItem('tokens', data.tokens);
                        
                        showToast("Đăng nhập thành công!", "success");
                        setTimeout(() => {
                            if (data.role === 'superadmin') window.location.href = 'superadmin.html';
                            else if (data.role === 'admin') window.location.href = 'admin.html';
                            else window.location.href = 'index.html';
                        }, 1500);
                    } else {
                        showToast("Đăng ký thành công! Hãy đăng nhập.", "success");
                        toggleMode();
                        btn.innerText = originalText;
                        btn.disabled = false;
                        btn.style.opacity = "1";
                    }
                } else {
                    showToast(data.message || "Truy cập bị từ chối", "error");
                    btn.innerText = originalText;
                    btn.disabled = false;
                    btn.style.opacity = "1";
                }
            } catch (e) {
                showToast("Lỗi kết nối máy chủ", "error");
                btn.innerText = originalText;
                btn.disabled = false;
                btn.style.opacity = "1";
            }
        }
        
        document.addEventListener('keypress', function (e) {
            if (e.key === 'Enter') handleAuth();
        });
    </script>
</body>
</html>